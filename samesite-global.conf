# This file is meant to be included in global scope. 
# The second stanza sets up variables for samesite-vhost.conf, which will set 'SAMESITE_SKIP' as a per-request
# environment variable that is used as a conditional by the final `Header` directive.

# Requires mod_rewrite and mod_setenvif be loaded.

# You may substitute other flags or try to match a subset of cookie values to treat
# them differently (examples needed)
#
# 1. Add SameSite=None and Secure if no SameSite already.
Header always edit Set-Cookie "^(?!.*(\s+|;)(?i)SameSite=)(.*)" "$0; SameSite=None; Secure" env=!SAMESITE_SKIP
# 2. Remove duplicate SECURE flag (this keeps the above regex simpler)
Header always edit Set-Cookie "(.*(\s+|;)(?i)Secure(\s+|;).*)Secure$" "$1" env=!SAMESITE_SKIP

#
# No need to read/edit below this line for end users.
#

# Simplified checks not requiring mod_rewrite and vhost config
# https://www.chromium.org/updates/same-site/incompatible-clients
# https://catchjs.com/Blog/SameSiteCookies
BrowserMatch "OS 12_.*CriOS" SAMESITE_SKIP=1
BrowserMatch "Chrome/[56]" SAMESITE_SKIP=1
BrowserMatch "OS X 10_14_.*Version/.*Safari"    SAMESITE_SKIP=1
BrowserMatch "OS X 10_14_.*(KHTML, like Gecko)" SAMESITE_SKIP=1

# Skip all UCBrowser
BrowserMatch "UCBrowser/" SAMESITE_SKIP=1
# Allow on 12.13.2 and higher
BrowserMatch "UCBrowser/12\.13.[2-9]" !SAMESITE_SKIP
# Allow on 12.14-12.19 and higher
BrowserMatch "UCBrowser/12\.1[4-9]"   !SAMESITE_SKIP
# Allow on remaining 12.* 
BrowserMatch "UCBrowser/12\.[2-9]"    !SAMESITE_SKIP
BrowserMatch "UCBrowser/1[3-9]"       !SAMESITE_SKIP
BrowserMatch "UCBrowser/[2-9][\d]"    !SAMESITE_SKIP

